<script>
  console.log("âš¡ Custom.html is loaded!");
  console.log("DEFAULT_THEME (raw Hugo):", "{{ .Site.Params.theme }}");
  console.log("ALLOWED_THEMES (raw Hugo):", "{{ .Site.Params.themeOptions }}");

  // === 1. Khai bÃ¡o biáº¿n global an toÃ n ===
  window.DEFAULT_THEME = "{{ .Site.Params.theme | default "dark" }}";
  window.ALLOWED_THEMES = {{ .Site.Params.themeOptions | default (slice "dark" "light" "hacker" "solarized" "kimbie") | jsonify }};

  // === 2. Láº¥y root & localTheme an toÃ n ===
  var root = window.root || document.getElementById('root');
  var localTheme = localStorage.getItem('theme') || window.DEFAULT_THEME;

  // === 3. Ãp dá»¥ng theme ===
  if (root) {
    if (!localTheme || localTheme === "undefined" || localTheme === "null") {
      localTheme = window.DEFAULT_THEME;
      localStorage.setItem('theme', localTheme);
    }
    root.className = 'theme__' + localTheme;
    console.log("ðŸŽ¨ Applied theme:", localTheme);
  } else {
    console.warn("âš ï¸ Cannot find #root element");
  }

  // === 4. HÃ m Ä‘á»•i theme toÃ n cá»¥c ===
window.applyTheme = function(theme) {
  theme = String(theme || "").toLowerCase();
  if (!window.ALLOWED_THEMES.includes(theme)) {
    console.warn("ðŸš« Invalid theme:", theme);
    return;
  }

  // Cáº­p nháº­t localStorage
  localStorage.setItem('theme', theme);

  // XÃ³a háº¿t class theme__... trÆ°á»›c khi thÃªm má»›i
  if (root) {
    root.classList.forEach(cls => {
      if (cls.startsWith("theme__")) root.classList.remove(cls);
    });
    root.classList.add("theme__" + theme);
  }

  console.log("âœ… Theme switched to:", theme);
};

</script>
